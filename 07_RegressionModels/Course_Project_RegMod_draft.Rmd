---
title: "Course Project - Regression Models"
author: "attila.toth86"
date: "21st Oct 2015"
output: html_document
---

This document is created for "Course Project" assignment in the framework of Regression Models course (part of Data Science Specialization by Johns Hopkins University Bloomberg School of Public Health on Coursera).

# The Challenge

Working for *Motor Trend*, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon. They are particularly interested in the following two questions:

 - Is an automatic or manual transmission better for MPG?
 - Quantify the MPG difference between automatic and manual transmissions?

# Executive Summary

To be detailed...

# Data Overview

Data to be analysed for this exercise reside as a built-in object, called `mtcars`, comes along with any R distribution. Let's take a first look at it:
 
```{r}
str(mtcars)
```

From R documentation (`?mtcars`) the following information can be obtained about the dataset:

|Variable|Description|
|--------|-----------|
|mpg|Miles/(US) gallon|
|cyl|Number of cylinders|
|disp|Displacement (cu.in.)|
|hp|Gross horsepower|
|drat|Rear axle ratio|
|wt|Weight (lb/1000)|
|qsec|1/4 mile time|
|vs|V/S|
|am|Transmission (0 = automatic, 1 = manual)|
|gear|Number of forward gears|
|carb|Number of carburetors|

# Exploratory Data Analyses

First, I load all the necessary R packages for further analyses:

```{r message=FALSE}
library(ggplot2)
library(reshape)
library(plyr)
library(dplyr)
library(leaps)
```

Let's take a look at the outcome variable (miles per gallon)

```{r}
summary(mtcars$mpg)
ggplot(mtcars, aes(x=mpg)) + geom_density(fill="black", alpha=0.3) + 
  geom_density(aes(fill=factor(am)), alpha=0.6)
```

To explore relationship patterns between variables and Miles per Gallon measure I plotted all variables against the outcome.

```{r}
mtcars_var_scaled <- data.frame(scale(mtcars)) %>% select(cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb)
mtcars_scaled <- cbind(mpg=mtcars$mpg, mtcars_var_scaled)
mtcars_sc_m <- melt(mtcars_scaled, id="mpg")
ggplot(mtcars_sc_m, aes(y=mpg, x=value)) + geom_point(position="jitter") + facet_wrap(~variable, nrow=2)
```

To be detailed...

# Model fit / model selection strategy

This part is about variable selection.

## Stepwise variable selection

```{r results='hide'}
full_model <- lm(mpg ~ ., mtcars)
final_model <- step(full_model)
```

In order to find the best linear regression model onto our dataset I performed some model selection algorythm. First, most obvious try was the `step()` function. The following model has been selected in a backward stepwise process as the best fit, that incorporates the following variables: `r names(final_model$coefficients[2:4])`.

```{r}
final_model
```

## Regression subset selection including exhaustive search

Performing different method for variable selection, the result has not changed.

```{r}
subset <- regsubsets(mpg ~ cyl+disp+hp+drat+wt+qsec+vs+am+gear+carb, mtcars)
plot(subset)
```


To be detailed...

# Obsolete content

```{r eval=FALSE}
table(mtcars$am)
am_means <- data.frame(value=rbind(totalmean=mean(mtcars$mpg), automean=mean(mtcars[mtcars$am==1,]$mpg), manmean=mean(mtcars[mtcars$am==0,]$mpg)))
ggplot(mtcars, aes(y=mpg, x=factor(am))) + geom_boxplot()
mtcars_melted <- melt(mtcars, id="mpg")

null <- lm(mpg ~ 1, mtcars)

step(null, scope=list(lower=null, upper=full), direction="forward") 
step(full, data=mtcars, direction="backward") 
step(null, scope = list(upper=full), data=mtcars, direction="both")
```
