---
title: "Course Project - Regression Models"
output: pdf_document
---

This document is created for "Course Project" assignment in the framework of Regression Models course (part of Data Science Specialization by Johns Hopkins University Bloomberg School of Public Health on Coursera).

# The Challenge

Working for *Motor Trend*, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon. They are particularly interested in the following two questions:

 - Is an automatic or manual transmission better for MPG?
 - Quantify the MPG difference between automatic and manual transmissions?

# Executive Summary

To be detailed...

# Data Overview

Data to be analysed for this exercise reside as a built-in object, called `mtcars`, comes along with any R distribution. Let's take a first look at it:
 
```{r echo=FALSE}
# Overview of variables
str(mtcars)
```

From R documentation (`?mtcars`) the following information can be obtained about the dataset:

|Variable|Description|
|--------|-----------|
|mpg|Miles/(US) gallon|
|cyl|Number of cylinders|
|disp|Displacement (cu.in.)|
|hp|Gross horsepower|
|drat|Rear axle ratio|
|wt|Weight (lb/1000)|
|qsec|1/4 mile time|
|vs|V/S|
|am|Transmission (0 = automatic, 1 = manual)|
|gear|Number of forward gears|
|carb|Number of carburetors|

# Exploratory Data Analyses

```{r message=FALSE, echo=FALSE}
# First, I load all the necessary R packages for further analyses:
library(ggplot2); library(reshape); library(plyr); library(dplyr); library(leaps); library(GGally);
```

Let's take a look at the outcome variable (miles per gallon). Observed mean is **`r round(mean(mtcars$mpg),2)`** with **`r round(sd(mtcars$mpg),2)`** standard deviation; for automatic cars the mean is *`r round(mean(mtcars$mpg[mtcars$am==0]),2)`* (standard deviation = *`r round(sd(mtcars$mpg[mtcars$am==0]),2)`*), for manual it is *`r round(mean(mtcars$mpg[mtcars$am==1]),2)`* (standard deviation = *`r round(sd(mtcars$mpg[mtcars$am==1]),2)`*). For distribution graphs please refer to *Figure 1* in the appendix.

To explore relationship patterns between variables and Miles per Gallon measure I plotted all (normalized) variables against the outcome (Figure 2).

# Model fit / model selection strategy

This part is about selecting the most relevant variables that explain miles per gallon measure most precisely. In order to find the best fitting linear regression model I have revised outcomes of some model selection algorythm.

## Stepwise variable selection

```{r results='hide', echo=FALSE}
full_model <- lm(mpg ~ ., mtcars)
final_model <- step(full_model)
```

The first, most obvious try for variable selection is the stepwise algorythm, provided by `step()` function. The following model has been selected in a _backward_ stepwise process as the best fit, that incorporates the following variables: `r names(final_model$coefficients[1:4])` with the corresponding coefficients of `r final_model$coef`.

## Regression subset selection including exhaustive search

To verify the selected variables, I performed a different method for variable selection provided by `leaps` R library. (Figure 3) This result proofed the previously selected three variables.

To be detailed...

# Appendix

## Figure 1: Distribution of Miles Per Gallon

```{r echo=FALSE}
ggplot(mtcars, aes(x=mpg)) + geom_density(fill="black", alpha=0.3) + 
  geom_density(aes(fill=factor(am)), alpha=0.6)
```

## Figure 2: Outcome - Variable Regression Matrix

```{r echo=FALSE}
# Normalization
mtcars_var_scaled <- data.frame(scale(mtcars)) %>% select(cyl, disp, hp, drat, wt, qsec, vs, am, gear, carb)
mtcars_scaled <- cbind(mpg=mtcars$mpg, mtcars_var_scaled)
# Melt
mtcars_sc_m <- melt(mtcars_scaled, id="mpg")
# Plotting
ggplot(mtcars_sc_m, aes(y=mpg, x=value)) + geom_point(position="jitter") + facet_wrap(~variable, nrow=2)

# Correlation table
# ggpairs(mtcars, lower = list(continuous = "smooth"))
```

# Figure 3: Regression subset selection including exhaustive search

```{r echo=FALSE}
subset <- regsubsets(mpg ~ cyl+disp+hp+drat+wt+qsec+vs+am+gear+carb, mtcars)
plot(subset)
```

# Pointing criteria

Todo:

 - interpret the coefficients
 - do some exploratory data analyses
 - fit multiple models and detail their strategy for model selection
 - answer the questions of interest or detail why the question(s) is (are) not answerable
 - do a residual plot and some diagnostics
 - quantify the uncertainty in their conclusions and/or perform an inference correctly

Done:

 - include an executive summary
 - done in Rmd (knitr)
 - brief (about 2 pages long) for the main body of the report and no longer than 5 with supporting appendix of figures

# Obsolete content

```{r eval=FALSE}
table(mtcars$am)
am_means <- data.frame(value=rbind(totalmean=mean(mtcars$mpg), automean=mean(mtcars[mtcars$am==1,]$mpg), manmean=mean(mtcars[mtcars$am==0,]$mpg)))
ggplot(mtcars, aes(y=mpg, x=factor(am))) + geom_boxplot()
mtcars_melted <- melt(mtcars, id="mpg")

null <- lm(mpg ~ 1, mtcars)

step(null, scope=list(lower=null, upper=full), direction="forward") 
step(full, data=mtcars, direction="backward") 
step(null, scope = list(upper=full), data=mtcars, direction="both")
```
