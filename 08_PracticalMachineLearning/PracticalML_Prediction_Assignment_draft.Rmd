---
title: "Practical Machine Learning - Prediction Assignment"
author: "attila.toth86"
output: html_document
---

# Background

Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible 
to collect a large amount of data about personal activity relatively 
inexpensively. These type of devices are part of the quantified self movement â€“ 
a group of enthusiasts who take measurements about themselves regularly to 
improve their health, to find patterns in their behavior, or because they are 
tech geeks. One thing that people regularly do is quantify how much of a 
particular activity they do, but they rarely quantify how well they do it. In 
this project, your goal will be to use data from accelerometers on the belt, 
forearm, arm, and dumbell of 6 participants. They were asked to perform barbell 
lifts correctly and incorrectly in 5 different ways. More information is 
available from the website here: http://groupware.les.inf.puc-rio.br/har (see 
the section on the Weight Lifting Exercise Dataset). 

# Data 

 - The training data for this project are available here: 
 https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv
 - The test data are available here: 
 https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

Let's download if they are not yet in the working directory and load them into 
memory.

```{r cache=TRUE}
if(file.exists("pml-training.csv")==FALSE) 
    {
    download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"
                  ,destfile = "pml-training.csv"
                  #,method="curl"
                  )
     }
if(file.exists("pml-testing.csv")==FALSE) 
    {
    download.file("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"
                  ,destfile = "pml-testing.csv"
                  #,method="curl"
                  )
     }
pml <- read.csv("pml-training.csv")
orig_pml_test <- read.csv("pml-testing.csv")
```

The data for this project come from this source: 
http://groupware.les.inf.puc-rio.br/har. If you use the document you create for 
this class for any purpose please cite them as they have been very generous in 
allowing their data to be used for this kind of assignment. 

# Goal

The goal of this project is to predict the manner in which they did the 
exercise. This is the `classe` variable in the training set. Any of the other 
variables are allowed use for prediction. This report describes how the model 
was built, how cross validation was used, what the expected out of sample error 
is, and why or how the choices were made.

# Exploratory Data Analysis

Let's load the necessary packages.

```{r}
library(caret)
```

"Setting seed" for reproducible results.

```{r}
set.seed(1234)
```

## Data splitting

As always, my first step is to slice up our given dataset to training and 
testing datasets. Testing dataset will not be touched until my model is ready.
Thus, any type of exploratory data analysis will be executed only on training 
set to avoid my model to be biased by testing data part.

```{r}
intrain <- createDataPartition(y = pml$classe, p=0.75, list=FALSE)
pmltrain <- pml[intrain,]
pmltest <- pml[-intrain,]

# to be considered: K-fold
```

Let's take a look at the training dataset and the predictable outcome variable.

```{r}
str(pmltrain, list.len = 200)
summary(pmltrain$classe)
```

I decided to remove `user_name` since it would bring bias in the prediction 
(overfitting to this specific dataset) but would not add to the prediction power 
of a generalized model. (E.g. if Carlitos always performed his exercise 
correctly then learning algorythms would make use of this information and apply
this information for prediction. However, it might be useful information for our
given test set but for generalized model, where we do not have the any user 
information, obviously it adds no value.)

```{r}
pmltrain <- pmltrain[,-2]
```

`raw_timestamp_part_1`, 'raw_timestamp_part_2', 'cvtd_timestamp'

Check for zero covariates (features with zero or close to zero variance), and
see if I can remove them from dataset.

```{r}
nsv <- nearZeroVar(pmltrain,saveMetrics=TRUE)
nsv

# pmltrain <- pmltrain[,nsv$nzv==FALSE]
```

Some variables are classified as near-to-zero-variable but none of them is
actually zero. So at this point I keep them.

Let's train a model with Random Forest, as it is a widely used classifier. (I
could have used Linear Discriminants, multinomial logit, Support Vector 
Machines, etc..)

```{r cache=TRUE}
mdl <- train(classe~., data=pmltrain, method = "rf")

```

I defined `pml_write_files` function to write out predictions into 20 separate 
files. (Source: Practical Machine Learning, Course Project Submission 
assignement instructions, 
url=https://class.coursera.org/predmachlearn-034/assignment/view?assignment_id=5)

```{r}
pml_write_files = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}
```

